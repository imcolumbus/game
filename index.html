<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§¤ì¼ë§¤ì¼ ë‘ë‡Œ íŠ¼íŠ¼</title>
    
    <!-- React ë° Tailwind CSS ë¡œë“œ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ ì •ì˜ -->
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes bounceShort { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .animate-zoom-in { animation: zoomIn 0.3s ease-out forwards; }
        .animate-bounce-short { animation: bounceShort 0.5s ease-in-out; }
        body { font-family: "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í…€ */
        .custom-input:focus { outline: none; border-color: #16a34a; ring: 2px solid #16a34a; }
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-amber-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ---
        const IconBase = ({ children, color = "currentColor", size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"></polygon></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path></IconBase>;
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"></polyline></IconBase>;
        const XIcon = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>;
        const Star = ({ fill, ...props }) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" fill={fill || "none"}></polygon></IconBase>;
        const Heart = ({ fill, ...props }) => <IconBase {...props}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" fill={fill || "none"}></path></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M12 15a7 7 0 0 0 7-7c0-2-3-2-3-2h-8s-3 0-3 2a7 7 0 0 0 7 7z"></path><path d="M12 15v7"></path></IconBase>;
        const CalendarIcon = (props) => <IconBase {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></IconBase>;
        const Volume2 = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></IconBase>;
        const User = (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></IconBase>;
        const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></IconBase>;
        const Palette = (props) => <IconBase {...props}><circle cx="13.5" cy="6.5" r=".5"></circle><circle cx="17.5" cy="10.5" r=".5"></circle><circle cx="8.5" cy="7.5" r=".5"></circle><circle cx="6.5" cy="12.5" r=".5"></circle><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path></IconBase>;
        const Home = (props) => <IconBase {...props}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></IconBase>;
        const Scissors = (props) => <IconBase {...props}><circle cx="6" cy="6" r="3"></circle><circle cx="6" cy="18" r="3"></circle><line x1="20" y1="4" x2="8.12" y2="15.88"></line><line x1="14.47" y1="14.48" x2="20" y2="20"></line><line x1="8.12" y1="8.12" x2="12" y2="12"></line></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconBase>;
        const Target = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></IconBase>;
        const Hash = (props) => <IconBase {...props}><line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line></IconBase>;
        const Compass = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon></IconBase>;
        const PenTool = (props) => <IconBase {...props}><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></IconBase>;
        const Sun = (props) => <IconBase {...props}><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></IconBase>;
        const Moon = (props) => <IconBase {...props}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></IconBase>;
        const Coffee = (props) => <IconBase {...props}><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></IconBase>;

        // --- ì „ì—­ ìŠ¤íƒ€ì¼ ---
        const styles = {
            container: "min-h-screen flex flex-col items-center p-4 font-sans select-none touch-manipulation pb-10 bg-amber-50",
            card: "w-full max-w-md bg-white rounded-3xl shadow-xl p-6 flex flex-col items-center transition-all duration-300",
            button: "w-full py-5 text-xl font-bold rounded-2xl transition-transform active:scale-95 shadow-md flex items-center justify-center gap-2 border-b-4 active:border-b-0 mb-3",
            bigText: "text-5xl font-black text-gray-800 mb-6 mt-4 leading-tight text-center break-keep",
            instruction: "text-2xl text-gray-700 mb-4 text-center font-bold break-keep leading-snug bg-amber-100 px-4 py-2 rounded-lg w-full",
            subText: "text-lg text-gray-500 mb-6 text-center font-medium",
            feedbackOverlay: "fixed inset-0 flex items-center justify-center bg-black/30 z-50 pointer-events-none animate-fade-in",
            input: "w-full text-center text-4xl font-bold py-4 border-b-4 border-gray-300 focus:border-green-500 outline-none bg-transparent mb-8"
        };

        const praises = ["ì •ë§ ëŒ€ë‹¨í•˜ì„¸ìš”!", "ìµœê³ ì…ë‹ˆë‹¤!", "ì•„ì£¼ í›Œë¥­í•´ìš”!", "ë‡Œê°€ ì Šì–´ì§€ê³  ìˆì–´ìš”!", "ì™„ë²½í•©ë‹ˆë‹¤!", "ì°¸ ì˜í•˜ì…¨ì–´ìš”!", "ì‹¤ë ¥ì´ ì¢‹ìœ¼ì‹œë„¤ìš”!"];

        // --- 0. ì´ë¦„ ì…ë ¥ í™”ë©´ ---
        const NameInputScreen = ({ onNameSubmit, playSound }) => {
            const [inputVal, setInputVal] = useState('');
            return (
                <div className="flex flex-col items-center w-full animate-zoom-in mt-10">
                    <div className="bg-green-100 p-6 rounded-full mb-6"><User size={60} className="text-green-600" /></div>
                    <h2 className="text-3xl font-bold text-gray-800 mb-8 text-center">ë°˜ê°‘ìŠµë‹ˆë‹¤!<br/>ì„±í•¨ì´ ì–´ë–»ê²Œ ë˜ì‹œë‚˜ìš”?</h2>
                    <input type="text" className={styles.input} placeholder="ì´ë¦„ ì…ë ¥" value={inputVal} onChange={(e) => setInputVal(e.target.value)} />
                    <button onClick={() => { if (inputVal.trim().length > 0) { playSound('click'); onNameSubmit(inputVal); }}} disabled={inputVal.trim().length === 0} className={`${styles.button} ${inputVal.trim().length > 0 ? 'bg-green-500 text-white border-green-700' : 'bg-gray-200 text-gray-400 border-gray-300'}`}>í™•ì¸</button>
                </div>
            );
        };

        // --- NEW: ì˜¤ëŠ˜ì˜ ê¸°ë¡ì¥ (Daily Record) ---
        const DailyRecord = ({ onBack, playSound }) => {
            // ì‹ì‚¬ ìƒíƒœ: 0=ë¯¸ì…ë ¥, 1=ë°¥, 2=ë©´/ë¹µ, 3=ì£½/êµ­, 4=ì•ˆë¨¹ìŒ
            const [meals, setMeals] = useState({ morning: 0, lunch: 0, dinner: 0 });
            // í™œë™ ìƒíƒœ: ì„ íƒëœ í•­ëª© ë°°ì—´
            const [activities, setActivities] = useState([]);

            const mealOptions = [
                { id: 1, label: "ë°¥", icon: "ğŸš" },
                { id: 2, label: "ë©´/ë¹µ", icon: "ğŸœ" },
                { id: 3, label: "ê³¼ì¼/ì£½", icon: "ğŸ" },
                { id: 4, label: "ì•ˆë¨¹ìŒ", icon: "âŒ" },
            ];

            const actOptions = [
                { id: "walk", label: "ì‚°ì±…", icon: "ğŸš¶" },
                { id: "tv", label: "TV ì‹œì²­", icon: "ğŸ“º" },
                { id: "clean", label: "ì²­ì†Œ", icon: "ğŸ§¹" },
                { id: "read", label: "ë…ì„œ", icon: "ğŸ“–" },
                { id: "social", label: "ëª¨ì„", icon: "ğŸ‘¥" },
                { id: "nap", label: "ë‚®ì ", icon: "ğŸ’¤" },
                { id: "med", label: "ì•½ ë³µìš©", icon: "ğŸ’Š" },
                { id: "gym", label: "ìš´ë™", icon: "ğŸ’ª" },
            ];

            const toggleMeal = (time, id) => {
                playSound('click');
                setMeals(prev => ({ ...prev, [time]: prev[time] === id ? 0 : id }));
            };

            const toggleAct = (id) => {
                playSound('click');
                setActivities(prev => prev.includes(id) ? prev.filter(a => a !== id) : [...prev, id]);
            };

            return (
                <div className="w-full flex flex-col items-center animate-fade-in pb-8">
                    <div className="bg-orange-100 p-3 rounded-full mb-2 mt-2 shadow-sm"><PenTool size={40} className="text-orange-600" /></div>
                    <h1 className="text-2xl font-black text-gray-800 mb-6 text-center">ì˜¤ëŠ˜ì˜ ê¸°ë¡ì¥</h1>

                    {/* ì‹ì‚¬ ê¸°ë¡ */}
                    <div className="w-full bg-white p-4 rounded-2xl shadow-sm border border-gray-100 mb-4">
                        <h3 className="font-bold text-xl text-gray-700 mb-3 border-l-4 border-green-500 pl-2">ì‹ì‚¬ëŠ” í•˜ì…¨ë‚˜ìš”?</h3>
                        {['morning', 'lunch', 'dinner'].map((time) => (
                            <div key={time} className="mb-3 last:mb-0">
                                <div className="flex items-center gap-2 mb-2">
                                    {time === 'morning' && <Sun size={20} className="text-orange-500"/>}
                                    {time === 'lunch' && <Sun size={20} className="text-yellow-500"/>}
                                    {time === 'dinner' && <Moon size={20} className="text-purple-500"/>}
                                    <span className="font-bold text-gray-600">
                                        {time === 'morning' ? "ì•„ì¹¨" : time === 'lunch' ? "ì ì‹¬" : "ì €ë…"}
                                    </span>
                                </div>
                                <div className="flex gap-2 justify-between">
                                    {mealOptions.map((opt) => (
                                        <button 
                                            key={opt.id} 
                                            onClick={() => toggleMeal(time, opt.id)}
                                            className={`flex-1 py-2 rounded-lg text-sm font-bold border-2 transition-all ${meals[time] === opt.id ? 'bg-green-100 border-green-500 text-green-800 scale-105' : 'bg-gray-50 border-gray-100 text-gray-400'}`}
                                        >
                                            <span className="text-xl block mb-1">{opt.icon}</span>
                                            {opt.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* í™œë™ ê¸°ë¡ */}
                    <div className="w-full bg-white p-4 rounded-2xl shadow-sm border border-gray-100 mb-6">
                        <h3 className="font-bold text-xl text-gray-700 mb-3 border-l-4 border-blue-500 pl-2">ì˜¤ëŠ˜ í•œ ì¼ì€?</h3>
                        <div className="grid grid-cols-4 gap-2">
                            {actOptions.map((act) => (
                                <button 
                                    key={act.id} 
                                    onClick={() => toggleAct(act.id)}
                                    className={`aspect-square rounded-xl border-2 flex flex-col items-center justify-center transition-all ${activities.includes(act.id) ? 'bg-blue-100 border-blue-500 text-blue-800' : 'bg-gray-50 border-gray-100 text-gray-400'}`}
                                >
                                    <span className="text-2xl mb-1">{act.icon}</span>
                                    <span className="text-xs font-bold">{act.label}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    <button onClick={onBack} className={`${styles.button} bg-gray-500 text-white border-gray-700`}>ì €ì¥í•˜ê³  ë‚˜ê°€ê¸°</button>
                </div>
            );
        };

        // --- ë©”ë‰´ í™”ë©´ (ê²Œì„ ì„ íƒ) ---
        const GameMenu = ({ userName, onStartCourse, onSelectGame, onOpenRecord }) => {
            const games = [
                { id: 'math', name: 'ê³„ì‚° í•˜ê¸°', icon: Star, color: 'text-amber-500', bg: 'bg-amber-50', border: 'border-amber-100' },
                { id: 'word', name: 'ì†ë‹´ í€´ì¦ˆ', icon: BookOpen, color: 'text-purple-600', bg: 'bg-purple-50', border: 'border-purple-100' },
                { id: 'spatial', name: 'ë‹¤ë¥¸ ê·¸ë¦¼', icon: Search, color: 'text-blue-600', bg: 'bg-blue-50', border: 'border-blue-100' },
                { id: 'stroop', name: 'ìƒ‰ê¹” íŒë‹¨', icon: Palette, color: 'text-indigo-600', bg: 'bg-indigo-50', border: 'border-indigo-100' },
                { id: 'memory', name: 'ìˆœì„œ ê¸°ì–µ', icon: RotateCcw, color: 'text-pink-500', bg: 'bg-pink-50', border: 'border-pink-100' },
                { id: 'number', name: 'ìˆ«ì ë¹„êµ', icon: Hash, color: 'text-teal-600', bg: 'bg-teal-50', border: 'border-teal-100' },
                { id: 'rps', name: 'ê°€ìœ„ ë°”ìœ„ ë³´', icon: Scissors, color: 'text-orange-500', bg: 'bg-orange-50', border: 'border-orange-100' },
                { id: 'reaction', name: 'ìˆœë°œë ¥ ê²Œì„', icon: Zap, color: 'text-yellow-500', bg: 'bg-yellow-50', border: 'border-yellow-100' },
                { id: 'category', name: 'ë‹¨ì–´ ë¶„ë¥˜', icon: Target, color: 'text-rose-600', bg: 'bg-rose-50', border: 'border-rose-100' },
                { id: 'direction', name: 'ë°©í–¥ ì°¾ê¸°', icon: Compass, color: 'text-cyan-600', bg: 'bg-cyan-50', border: 'border-cyan-100' },
            ];

            return (
                <div className="flex flex-col items-center w-full animate-fade-in pb-8">
                    <div className="bg-green-100 p-3 rounded-full mb-2 mt-2 shadow-sm"><Heart size={40} className="text-green-600" fill="#16a34a" /></div>
                    <h1 className="text-2xl font-black text-green-800 mb-4 text-center">ì•ˆë…•í•˜ì„¸ìš”, {userName}ë‹˜!</h1>
                    
                    <button onClick={onStartCourse} className="w-full py-6 text-2xl font-bold rounded-2xl bg-green-500 text-white shadow-lg flex flex-col items-center justify-center gap-1 active:scale-95 transition-transform border-b-4 border-green-700 active:border-b-0 active:translate-y-1 mb-6">
                        <div className="flex items-center gap-2"><Play fill="white" size={32} /> ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì½”ìŠ¤</div>
                        <span className="text-lg font-normal opacity-90">ì¢…í•© ë‘ë‡Œ ê²€ì§„ (ëœë¤ 5ì¢…)</span>
                    </button>

                    <div className="w-full grid grid-cols-2 gap-3 mb-6">
                         <button onClick={onOpenRecord} className="col-span-2 py-4 bg-orange-100 rounded-xl border-2 border-orange-200 text-orange-800 font-bold text-xl flex items-center justify-center gap-2 active:scale-95">
                            <PenTool size={24}/> ì˜¤ëŠ˜ì˜ ê¸°ë¡ì¥ ì“°ê¸°
                        </button>
                    </div>

                    <div className="w-full text-left mb-4"><span className="text-xl font-bold text-gray-700 border-l-4 border-amber-500 pl-3">ì›í•˜ëŠ” ìš´ë™ ê³ ë¥´ê¸°</span></div>
                    
                    <div className="grid grid-cols-2 gap-3 w-full">
                        {games.map(game => (
                            <button key={game.id} onClick={() => onSelectGame(game.id)} className={`p-4 rounded-xl border-2 ${game.border} hover:${game.bg} flex flex-col items-center shadow-sm active:scale-95 bg-white transition-colors`}>
                                <game.icon className={`${game.color} mb-2`} size={36}/>
                                <span className="font-bold text-xl text-gray-800">{game.name}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 1. ë‚ ì§œ ê¸°ì–µ (Orientation - Mandatory) ---
        const OrientationGame = ({ onComplete, onCorrect, onWrong }) => {
            const [qType, setQType] = useState(0); 
            const [options, setOptions] = useState([]);
            const [questionText, setQuestionText] = useState("");
            const [correctAnswer, setCorrectAnswer] = useState("");
            const [processing, setProcessing] = useState(false);

            useEffect(() => {
                const now = new Date();
                let ans = "", opts = [], q = "";
                if (qType === 0) {
                    q = "ì˜¬í•´ëŠ” ëª‡ ë…„ë„ ì¸ê°€ìš”?"; const year = now.getFullYear(); ans = `${year}ë…„`; opts = [year - 1, year, year + 1].map(y => `${y}ë…„`);
                } else if (qType === 1) {
                    q = "ì§€ê¸ˆì€ ëª‡ ì›” ì¸ê°€ìš”?"; const month = now.getMonth() + 1; ans = `${month}ì›”`; let w1 = month - 1 < 1 ? 12 : month - 1; let w2 = month + 1 > 12 ? 1 : month + 1; opts = [w1, month, w2].map(m => `${m}ì›”`);
                } else if (qType === 2) {
                    q = "ì˜¤ëŠ˜ì€ ë©°ì¹  ì¸ê°€ìš”?"; const date = now.getDate(); ans = `${date}ì¼`; let w1 = date - 1 < 1 ? 30 : date - 1; let w2 = date + 1 > 31 ? 1 : date + 1; opts = [w1, date, w2].map(d => `${d}ì¼`);
                } else if (qType === 3) {
                    q = "ì˜¤ëŠ˜ì€ ë¬´ìŠ¨ ìš”ì¼ ì¸ê°€ìš”?"; const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ']; const dayIdx = now.getDay(); ans = `${days[dayIdx]}ìš”ì¼`; let w1Idx = (dayIdx + 2) % 7; let w2Idx = (dayIdx + 5) % 7; opts = [`${days[w1Idx]}ìš”ì¼`, ans, `${days[w2Idx]}ìš”ì¼`];
                }
                setQuestionText(q); setCorrectAnswer(ans); setOptions(opts.sort(() => Math.random() - 0.5)); setProcessing(false);
            }, [qType]);

            const handleAnswer = (val) => {
                if (processing) return; 
                if (val === correctAnswer) {
                    setProcessing(true); onCorrect(10); 
                    if (qType >= 3) { setTimeout(onComplete, 1000); } else { setTimeout(() => { setQType(prev => prev + 1); }, 800); }
                } else { onWrong(); }
            };

            return (
                <div className="w-full flex flex-col items-center animate-fade-in" key={qType}>
                    <p className={styles.instruction}>ì¤€ë¹„ ìš´ë™: <span className="text-green-600">ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì–µí•˜ê¸°</span></p>
                    <div className="bg-green-50 px-6 py-8 rounded-2xl mb-6 w-full text-center border-2 border-green-100">
                        <div className="flex justify-center mb-2"><CalendarIcon size={40} className="text-green-600" /></div>
                        <p className={styles.bigText}>{questionText}</p>
                    </div>
                    <div className="grid grid-cols-1 gap-3 w-full">
                        {options.map((opt, idx) => (
                            <button key={idx} onClick={() => handleAnswer(opt)} className={`${styles.button} bg-white border-green-200 text-green-900 hover:bg-green-50`}>{opt}</button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 2. ì‚°ìˆ˜ (Math) ---
        const MathGame = ({ onComplete, onCorrect, onWrong }) => {
            const [problem, setProblem] = useState({ q: '', a: 0, options: [] });
            const [count, setCount] = useState(0);

            const generateProblem = () => {
                const type = Math.random();
                let qStr = "", ans = 0;
                if (type < 0.4) { 
                    const n1 = Math.floor(Math.random() * 20) + 10; const n2 = Math.floor(Math.random() * 9) + 1; ans = n1 + n2; qStr = `${n1} + ${n2}`;
                } else if (type < 0.8) { 
                    const n1 = Math.floor(Math.random() * 20) + 10; const n2 = Math.floor(Math.random() * 9) + 1; ans = n1 - n2; qStr = `${n1} - ${n2}`;
                } else { 
                    const n1 = Math.floor(Math.random() * 8) + 2; const n2 = Math.floor(Math.random() * 8) + 2; ans = n1 * n2; qStr = `${n1} Ã— ${n2}`;
                }
                const opts = [ans, ans + Math.floor(Math.random()*5)+1, ans - Math.floor(Math.random()*5)-1].sort(() => Math.random() - 0.5);
                setProblem({ q: `${qStr} = ?`, a: ans, options: opts });
            };
            useEffect(() => { generateProblem(); }, []);
            const handleAnswer = (val) => {
                if (val === problem.a) { onCorrect(20); if (count + 1 >= 5) { setTimeout(onComplete, 1000); } else { setCount(c => c + 1); generateProblem(); } } else { onWrong(); }
            };
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>ê°„ë‹¨í•œ <span className="text-amber-600">ê³„ì‚° ë¬¸ì œ</span>ì…ë‹ˆë‹¤.</p>
                    <div className="bg-amber-100 px-8 py-8 rounded-2xl mb-8 w-full text-center"><p className={styles.bigText}>{problem.q}</p></div>
                    <div className="grid grid-cols-1 gap-3 w-full">
                        {problem.options.map((opt, idx) => (<button key={idx} onClick={() => handleAnswer(opt)} className={`${styles.button} bg-white border-amber-200 text-amber-900 hover:bg-amber-50`}>{opt}</button>))}
                    </div>
                </div>
            );
        };

        // --- 3. ì†ë‹´ í€´ì¦ˆ (Word) - ë°ì´í„° 50ê°œ ì´ìƒ ë³´ê°• ---
        const WordGame = ({ onComplete, onCorrect, onWrong }) => {
            const [quiz, setQuiz] = useState(null);
            const [count, setCount] = useState(0);
            const [quizList, setQuizList] = useState([]);
            const allProverbs = [
                { q: "ê°€ëŠ” ë§ì´ ê³ ì™€ì•¼ [ ? ]", a: "ì˜¤ëŠ” ë§ì´ ê³±ë‹¤", w: "ì˜¤ëŠ” ë§ì´ ê±°ì¹ ë‹¤" }, 
                { q: "ëˆ„ì›Œì„œ [ ? ] ë¨¹ê¸°", a: "ë–¡", w: "ë°¥" }, 
                { q: "í‹°ëŒ ëª¨ì•„ [ ? ]", a: "íƒœì‚°", w: "ë™ì‚°" },
                { q: "ë“±ì” ë°‘ì´ [ ? ]", a: "ì–´ë‘¡ë‹¤", w: "ë°ë‹¤" }, 
                { q: "ì›ìˆ­ì´ë„ ë‚˜ë¬´ì—ì„œ [ ? ]", a: "ë–¨ì–´ì§„ë‹¤", w: "ë‚ ì•„ê°„ë‹¤" }, 
                { q: "ì„¸ ì‚´ ë²„ë¦‡ ì—¬ë“ ê¹Œì§€ [ ? ]", a: "ê°„ë‹¤", w: "ì•ˆ ê°„ë‹¤" },
                { q: "ì†Œ ìƒê³  [ ? ] ê³ ì¹œë‹¤", a: "ì™¸ì–‘ê°„", w: "ëŒ€ë¬¸" }, 
                { q: "ê³ ìƒ ëì— [ ? ]ì´ ì˜¨ë‹¤", a: "ë‚™", w: "ë³‘" }, 
                { q: "ì„œë‹¹ ê°œ ì‚¼ ë…„ì´ë©´ [ ? ]ì„ ìŠëŠ”ë‹¤", a: "í’ì›”", w: "ë…¸ë˜" },
                { q: "ì§€ë ì´ë„ ë°Ÿìœ¼ë©´ [ ? ]í•œë‹¤", a: "ê¿ˆí‹€", w: "ê°€ë§Œ" }, 
                { q: "í•˜ëŠ˜ì´ ë¬´ë„ˆì ¸ë„ ì†Ÿì•„ë‚  [ ? ]ì´ ìˆë‹¤", a: "êµ¬ë©", w: "ê¸°ë‘¥" }, 
                { q: "í˜¸ë‘ì´ë„ ì œ ë§ í•˜ë©´ [ ? ]", a: "ì˜¨ë‹¤", w: "ê°„ë‹¤" },
                { q: "ë°”ëŠ˜ ë„ë‘‘ì´ [ ? ] ë„ë‘‘ ëœë‹¤", a: "ì†Œ", w: "ë§" }, 
                { q: "ì—´ ë²ˆ ì°ì–´ ì•ˆ ë„˜ì–´ê°€ëŠ” [ ? ] ì—†ë‹¤", a: "ë‚˜ë¬´", w: "ëŒ" }, 
                { q: "ë§ í•œë§ˆë””ë¡œ [ ? ] ë¹š ê°šëŠ”ë‹¤", a: "ì²œ ëƒ¥", w: "ë§Œ ëƒ¥" },
                { q: "ì‘ì€ ê³ ì¶”ê°€ ë” [ ? ]", a: "ë§µë‹¤", w: "ë‹¬ë‹¤" }, 
                { q: "ê¿© ë¨¹ê³  [ ? ] ë¨¹ê³ ", a: "ì•Œ", w: "ë¬¼" }, 
                { q: "ëŒë‹¤ë¦¬ë„ ë‘ë“¤ê²¨ ë³´ê³  [ ? ]", a: "ê±´ë„ˆë¼", w: "ë›°ì–´ë¼" },
                { q: "ë¬´ìì‹ì´ [ ? ]ì", a: "ìƒíŒ”", w: "í•˜íŒ”" }, 
                { q: "ë°‘ ë¹ ì§„ ë…ì— [ ? ] ë¶“ê¸°", a: "ë¬¼", w: "ìˆ " }, 
                { q: "ë°±ì§€ì¥ë„ ë§ë“¤ë©´ [ ? ]", a: "ë‚«ë‹¤", w: "ë¬´ê²ë‹¤" },
                { q: "ë¹„ ì˜¨ ë’¤ì— ë•…ì´ [ ? ]", a: "êµ³ì–´ì§„ë‹¤", w: "ë¬´ë„ˆì§„ë‹¤" }, 
                { q: "ì‚¬ê³µì´ ë§ìœ¼ë©´ ë°°ê°€ [ ? ]ë¡œ ê°„ë‹¤", a: "ì‚°", w: "ë°”ë‹¤" }, 
                { q: "ì‹œì‘ì´ [ ? ]ì´ë‹¤", a: "ë°˜", w: "ì „ë¶€" },
                { q: "ì•„ë‹ˆ ë• êµ´ëšì— [ ? ] ë‚ ê¹Œ", a: "ì—°ê¸°", w: "ë¶ˆ" }, 
                { q: "ì•½ë°©ì— [ ? ]", a: "ê°ì´ˆ", w: "ì¸ì‚¼" }, 
                { q: "ì˜¤ë¥´ì§€ ëª»í•  ë‚˜ë¬´ëŠ” [ ? ]ë„ ë§ˆë¼", a: "ì³ë‹¤ë³´", w: "ë§Œì§€" },
                { q: "ìš°ë¬¼ ì•ˆ [ ? ]", a: "ê°œêµ¬ë¦¬", w: "ë‘êº¼ë¹„" }, 
                { q: "ì¥êµ¬ë©ì—ë„ ë³• ë“¤ ë‚  [ ? ]", a: "ìˆë‹¤", w: "ì—†ë‹¤" }, 
                { q: "ì²œ ë¦¬ ê¸¸ë„ [ ? ]ë¶€í„°", a: "í•œ ê±¸ìŒ", w: "ë‘ ê±¸ìŒ" },
                { q: "ì†Œë¬¸ë‚œ ì”ì¹˜ì— [ ? ] ì—†ë‹¤", a: "ë¨¹ì„ ê²ƒ", w: "ë³¼ ê²ƒ" }, 
                { q: "ê°œì²œì—ì„œ [ ? ] ë‚œë‹¤", a: "ìš©", w: "ë±€" }, 
                { q: "ë‚« ë†“ê³  [ ? ] ìë„ ëª¨ë¥¸ë‹¤", a: "ê¸°ì—­", w: "ë‹ˆì€" },
                { q: "ë˜¥ ë¬»ì€ ê°œê°€ [ ? ] ë¬»ì€ ê°œ ë‚˜ë¬´ë€ë‹¤", a: "ê²¨", w: "ì¬" },
                { q: "ë§ì€ ì²­ì‚°[ ? ]", a: "ìœ ìˆ˜", w: "ëª…ìˆ˜" },
                { q: "ë§¤ë„ ë¨¼ì € ë§ëŠ” ë†ˆì´ [ ? ]", a: "ë‚«ë‹¤", w: "ì•„í”„ë‹¤" },
                { q: "ëª©ë§ˆë¥¸ ë†ˆì´ [ ? ] íŒë‹¤", a: "ìš°ë¬¼", w: "ë„ë‘" },
                { q: "ë¯¿ëŠ” ë„ë¼ì— [ ? ] ì°íŒë‹¤", a: "ë°œë“±", w: "ì†ë“±" },
                { q: "ë°°ë³´ë‹¤ [ ? ]ì´ ë” í¬ë‹¤", a: "ë°°ê¼½", w: "ì–¼êµ´" },
                { q: "ì‚¬ì´Œì´ ë•…ì„ ì‚¬ë©´ [ ? ]ê°€ ì•„í”„ë‹¤", a: "ë°°", w: "ë¨¸ë¦¬" },
                { q: "ì‚° ì…ì— [ ? ] ì¹˜ë´", a: "ê±°ë¯¸ì¤„", w: "íŒŒë¦¬" },
                { q: "ìƒˆ ë°œì˜ [ ? ]", a: "í”¼", w: "ë•€" },
                { q: "ì‡ ë¿”ë„ ë‹¨ê¹€ì— [ ? ]", a: "ë¹¼ë¼", w: "ì˜ë¼ë¼" },
                { q: "ì•„ëŠ” ê¸¸ë„ [ ? ] ê°€ë¼", a: "ë¬¼ì–´", w: "ë›°ì–´" },
                { q: "ì–Œì „í•œ ê³ ì–‘ì´ [ ? ]ì— ë¨¼ì € ì˜¬ë¼ê°„ë‹¤", a: "ë¶€ëšœë§‰", w: "ì§€ë¶•" },
                { q: "ì—´ ê¸¸ ë¬¼ì†ì€ ì•Œì•„ë„ í•œ ê¸¸ [ ? ] ì†ì€ ëª¨ë¥¸ë‹¤", a: "ì‚¬ëŒ", w: "ì‚°" },
                { q: "ì›ƒëŠ” ë‚¯ì— [ ? ] ëª» ë±‰ëŠ”ë‹¤", a: "ì¹¨", w: "ìš•" },
                { q: "ìœ—ë¬¼ì´ ë§‘ì•„ì•¼ [ ? ]ì´ ë§‘ë‹¤", a: "ì•„ë«ë¬¼", w: "ë’·ë¬¼" },
                { q: "ì…ì´ ì—´ ê°œë¼ë„ [ ? ]ì´ ì—†ë‹¤", a: "í•  ë§", w: "ê°ˆ ê³³" },
                { q: "ìë¼ ë³´ê³  ë†€ë€ ê°€ìŠ´ [ ? ] ë³´ê³  ë†€ë€ë‹¤", a: "ì†¥ëšœê»‘", w: "ëƒ„ë¹„" }
            ];
            useEffect(() => { setQuizList([...allProverbs].sort(() => Math.random() - 0.5).slice(0, 5)); }, []);
            useEffect(() => { if (quizList.length > 0) { const cur = quizList[count]; setQuiz({ ...cur, options: [cur.a, cur.w].sort(() => Math.random() - 0.5) }); } }, [count, quizList]);
            const handleAnswer = (val) => { if (val === quiz.a) { onCorrect(20); if (count + 1 >= 3) { setTimeout(onComplete, 1000); } else { setCount(c => c + 1); } } else { onWrong(); } };
            if (!quiz) return null;
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>ë¹ˆ ì¹¸ì— ë“¤ì–´ê°ˆ <span className="text-purple-600">ì†ë‹´</span>ì„ ì™„ì„±í•˜ì„¸ìš”.</p>
                    <div className="bg-purple-50 px-6 py-8 rounded-2xl mb-8 w-full text-center border-2 border-purple-100"><p className={styles.bigText}>{quiz.q}</p></div>
                    <div className="grid grid-cols-1 gap-3 w-full">{quiz.options.map((opt, idx) => (<button key={idx} onClick={() => handleAnswer(opt)} className={`${styles.button} bg-white border-purple-200 text-purple-900 hover:bg-purple-50`}>{opt}</button>))}</div>
                </div>
            );
        };

        // --- 4. ë‹¤ë¥¸ ê·¸ë¦¼ ì°¾ê¸° (Spatial) ---
        const SpatialGame = ({ onComplete, onCorrect, onWrong }) => {
            const [items, setItems] = useState([]);
            const [count, setCount] = useState(0);
            const shapes = ['â—', 'â–²', 'â– ', 'â˜…', 'â™¥', 'â™¦']; const colors = ['text-red-500', 'text-blue-500', 'text-green-500', 'text-yellow-500', 'text-purple-500'];
            const generateLevel = () => {
                const isShapeDiff = Math.random() > 0.5; let grid = []; let answerIdx = Math.floor(Math.random() * 4); 
                if (isShapeDiff) {
                    const baseShape = shapes[Math.floor(Math.random() * shapes.length)]; let diffShape = baseShape; while(diffShape === baseShape) diffShape = shapes[Math.floor(Math.random() * shapes.length)]; const color = colors[Math.floor(Math.random() * colors.length)];
                    for(let i=0; i<4; i++) grid.push({ shape: i===answerIdx?diffShape:baseShape, color: color, isAns: i===answerIdx });
                } else {
                    const shape = shapes[Math.floor(Math.random() * shapes.length)]; const baseColorIdx = Math.floor(Math.random() * colors.length); const baseColor = colors[baseColorIdx]; let diffColor = baseColor; while(diffColor === baseColor) diffColor = colors[Math.floor(Math.random() * colors.length)];
                    for(let i=0; i<4; i++) grid.push({ shape: shape, color: i===answerIdx?diffColor:baseColor, isAns: i===answerIdx });
                }
                setItems(grid);
            };
            useEffect(() => { generateLevel(); }, []);
            const handleClick = (isAns) => { if (isAns) { onCorrect(20); if (count + 1 >= 3) { setTimeout(onComplete, 1000); } else { setCount(c => c + 1); generateLevel(); } } else { onWrong(); } };
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>ëª¨ì–‘ì´ë‚˜ ìƒ‰ê¹”ì´ <span className="text-blue-600">ë‹¤ë¥¸ í•˜ë‚˜</span>ë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>
                    <div className="grid grid-cols-2 gap-4 w-full max-w-[340px]">
                        {items.map((item, idx) => (<button key={idx} onClick={() => handleClick(item.isAns)} className="bg-white border-2 border-gray-200 rounded-2xl h-36 flex items-center justify-center shadow-sm active:scale-95 transition-transform"><span className={`text-7xl ${item.color}`}>{item.shape}</span></button>))}
                    </div>
                </div>
            );
        };

        // --- 5. ìƒ‰ê¹” ê¸€ì ì°¾ê¸° (Stroop) ---
        const StroopGame = ({ onComplete, onCorrect, onWrong }) => {
            const [question, setQuestion] = useState(null);
            const [count, setCount] = useState(0);
            const colorMap = [{ text: 'ë¹¨ê°•', class: 'text-red-500' }, { text: 'íŒŒë‘', class: 'text-blue-600' }, { text: 'ì´ˆë¡', class: 'text-green-600' }, { text: 'ë…¸ë‘', class: 'text-yellow-500' }, { text: 'ê²€ì •', class: 'text-gray-900' }];
            const generateQuestion = () => {
                const textIdx = Math.floor(Math.random() * colorMap.length); let colorIdx = Math.floor(Math.random() * colorMap.length); while(colorIdx === textIdx) colorIdx = Math.floor(Math.random() * colorMap.length);
                const correctVal = colorMap[colorIdx].text; const options = colorMap.map(c => c.text).sort(() => Math.random() - 0.5).slice(0, 4); if (!options.includes(correctVal)) options[0] = correctVal;
                setQuestion({ text: colorMap[textIdx].text, colorClass: colorMap[colorIdx].class, answer: correctVal, options: options.sort(() => Math.random() - 0.5) });
            };
            useEffect(() => { generateQuestion(); }, []);
            const handleAnswer = (val) => { if (val === question.answer) { onCorrect(20); if (count + 1 >= 5) { setTimeout(onComplete, 1000); } else { setCount(c => c + 1); generateQuestion(); } } else { onWrong(); } };
            if (!question) return null;
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>ê¸€ìì˜ <span className="text-indigo-600">ìƒ‰ê¹”</span>ì´ ë¬´ì—‡ì¸ì§€ ê³ ë¥´ì„¸ìš”.</p>
                    <p className={styles.subText}>(ê¸€ì ë‚´ìš©ì— ì†ì§€ ë§ˆì„¸ìš”!)</p>
                    <div className="bg-gray-100 px-8 py-10 rounded-2xl mb-8 w-full text-center border-2 border-gray-200"><p className={`text-7xl font-black ${question.colorClass}`}>{question.text}</p></div>
                    <div className="grid grid-cols-2 gap-3 w-full">{question.options.map((opt, idx) => (<button key={idx} onClick={() => handleAnswer(opt)} className={`${styles.button} bg-white border-indigo-200 text-indigo-900 hover:bg-indigo-50`}>{opt}</button>))}</div>
                </div>
            );
        };

        // --- 6. ìˆ«ì ë¹„êµ (Number) ---
        const NumberGame = ({ onComplete, onCorrect, onWrong }) => {
            const [q, setQ] = useState(null); const [count, setCount] = useState(0);
            const generate = () => {
                const nums = [0,0,0].map(() => Math.floor(Math.random() * 90) + 10);
                const isMax = Math.random() > 0.5;
                setQ({ nums, isMax, ans: isMax ? Math.max(...nums) : Math.min(...nums) });
            };
            useEffect(() => { generate(); }, []);
            const handleAnswer = (val) => { if (val === q.ans) { onCorrect(20); if (count + 1 >= 5) setTimeout(onComplete, 1000); else { setCount(c => c + 1); generate(); } } else onWrong(); };
            if(!q) return null;
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>ì„¸ ìˆ«ì ì¤‘ <span className="text-teal-600">{q.isMax ? "ê°€ì¥ í°" : "ê°€ì¥ ì‘ì€"}</span> ìˆ«ìë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>
                    <div className="grid grid-cols-1 gap-4 w-full mt-4">
                        {q.nums.map((n, i) => (<button key={i} onClick={() => handleAnswer(n)} className={`${styles.button} bg-white border-teal-200 text-teal-900 text-6xl h-32`}>{n}</button>))}
                    </div>
                </div>
            );
        }

        // --- 7. ê°€ìœ„ë°”ìœ„ë³´ (RPS) ---
        const RPSGame = ({ onComplete, onCorrect, onWrong }) => {
            const [q, setQ] = useState(null); const [count, setCount] = useState(0);
            const rps = ['ê°€ìœ„', 'ë°”ìœ„', 'ë³´'];
            const generate = () => {
                const cpu = rps[Math.floor(Math.random()*3)];
                const isWin = Math.random() > 0.5; // ì´ê²¨ë¼ or ì ¸ë¼
                setQ({ cpu, isWin });
            };
            useEffect(() => { generate(); }, []);
            const checkWin = (cpu, user) => {
                if (cpu === user) return 'draw';
                if ((user === 'ê°€ìœ„' && cpu === 'ë³´') || (user === 'ë°”ìœ„' && cpu === 'ê°€ìœ„') || (user === 'ë³´' && cpu === 'ë°”ìœ„')) return 'win';
                return 'lose';
            }
            const handleAnswer = (user) => {
                const result = checkWin(q.cpu, user);
                const isCorrect = (q.isWin && result === 'win') || (!q.isWin && result === 'lose');
                if (isCorrect) { onCorrect(20); if (count + 1 >= 5) setTimeout(onComplete, 1000); else { setCount(c => c + 1); generate(); } } else onWrong(); 
            };
            if(!q) return null;
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}><span className="text-orange-600 font-bold text-4xl">{q.cpu}</span>ë¥¼ ìƒëŒ€ë¡œ <br/><span className={`text-5xl ${q.isWin ? 'text-blue-600' : 'text-red-600'}`}>{q.isWin ? "ì´ê¸°ì„¸ìš”!" : "ì§€ì„¸ìš”!"}</span></p>
                    <div className="flex gap-2 w-full mt-8">
                        {rps.map((r, i) => (<button key={i} onClick={() => handleAnswer(r)} className={`${styles.button} bg-white border-orange-200 text-orange-900`}>{r}</button>))}
                    </div>
                </div>
            );
        }

        // --- 8. ìˆœë°œë ¥ (Reaction) ---
        const ReactionGame = ({ onComplete, onCorrect, onWrong }) => {
            const [state, setState] = useState('wait'); // wait, ready
            const [count, setCount] = useState(0);
            const timerRef = useRef(null);

            const startWait = () => {
                setState('wait');
                const delay = Math.random() * 2000 + 1500; // 1.5 ~ 3.5s
                timerRef.current = setTimeout(() => { setState('ready'); }, delay);
            };
            useEffect(() => { startWait(); return () => clearTimeout(timerRef.current); }, []);
            
            const handleClick = () => {
                if (state === 'ready') {
                    onCorrect(20);
                    if (count + 1 >= 3) setTimeout(onComplete, 1000); else { setCount(c => c + 1); startWait(); }
                } else {
                    // Early click
                    clearTimeout(timerRef.current);
                    onWrong();
                    setTimeout(startWait, 500);
                }
            };
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>ë°°ê²½ì´ <span className="text-green-600">ì´ˆë¡ìƒ‰</span>ì´ ë˜ë©´<br/>ë¹ ë¥´ê²Œ ëˆ„ë¥´ì„¸ìš”!</p>
                    <button onMouseDown={handleClick} onTouchStart={handleClick} className={`w-full h-64 rounded-3xl shadow-xl flex items-center justify-center transition-colors duration-200 ${state === 'ready' ? 'bg-green-500 border-b-8 border-green-700' : 'bg-gray-200 border-b-8 border-gray-300'}`}>
                        {state === 'ready' ? <span className="text-white text-6xl font-black">ì§€ê¸ˆ!!!</span> : <span className="text-gray-400 text-4xl font-bold">ê¸°ë‹¤ë¦¬ì„¸ìš”...</span>}
                    </button>
                </div>
            );
        }

        // --- 9. ë‹¨ì–´ ë¶„ë¥˜ (Category) - ë°ì´í„° ë³´ê°• ---
        const CategoryGame = ({ onComplete, onCorrect, onWrong }) => {
            const [q, setQ] = useState(null); const [count, setCount] = useState(0);
            const data = [
                { t: 'ì‚¬ê³¼', c: 'ê³¼ì¼' }, { t: 'ë°°', c: 'ê³¼ì¼' }, { t: 'í¬ë„', c: 'ê³¼ì¼' }, { t: 'ìˆ˜ë°•', c: 'ê³¼ì¼' }, { t: 'ì°¸ì™¸', c: 'ê³¼ì¼' },
                { t: 'ê³ ë“±ì–´', c: 'ìƒì„ ' }, { t: 'ê°ˆì¹˜', c: 'ìƒì„ ' }, { t: 'ì˜¤ì§•ì–´', c: 'ìƒì„ ' }, { t: 'ì¡°ê¸°', c: 'ìƒì„ ' }, { t: 'ë©¸ì¹˜', c: 'ìƒì„ ' },
                { t: 'í˜¸ë‘ì´', c: 'ë™ë¬¼' }, { t: 'ì‚¬ì', c: 'ë™ë¬¼' }, { t: 'ê°•ì•„ì§€', c: 'ë™ë¬¼' }, { t: 'í† ë¼', c: 'ë™ë¬¼' }, { t: 'ê³ ì–‘ì´', c: 'ë™ë¬¼' },
                { t: 'ìë™ì°¨', c: 'íƒˆê²ƒ' }, { t: 'ë¹„í–‰ê¸°', c: 'íƒˆê²ƒ' }, { t: 'ìì „ê±°', c: 'íƒˆê²ƒ' }, { t: 'ê¸°ì°¨', c: 'íƒˆê²ƒ' }, { t: 'ë²„ìŠ¤', c: 'íƒˆê²ƒ' },
                { t: 'ë°”ì§€', c: 'ì˜·' }, { t: 'ì¹˜ë§ˆ', c: 'ì˜·' }, { t: 'ì–‘ë§', c: 'ì˜·' }, { t: 'ì¥ê°‘', c: 'ì˜·' }, { t: 'ëª¨ì', c: 'ì˜·' },
                { t: 'ëƒ‰ì¥ê³ ', c: 'ê°€ì „' }, { t: 'ì„¸íƒê¸°', c: 'ê°€ì „' }, { t: 'TV', c: 'ê°€ì „' }, { t: 'ì—ì–´ì»¨', c: 'ê°€ì „' }, { t: 'ì²­ì†Œê¸°', c: 'ê°€ì „' }
            ];
            const cats = ['ê³¼ì¼', 'ìƒì„ ', 'ë™ë¬¼', 'íƒˆê²ƒ', 'ì˜·', 'ê°€ì „'];
            const generate = () => {
                const item = data[Math.floor(Math.random() * data.length)];
                let wrongCat = cats[Math.floor(Math.random() * cats.length)];
                while(wrongCat === item.c) wrongCat = cats[Math.floor(Math.random() * cats.length)];
                setQ({ item, opts: [item.c, wrongCat].sort(() => Math.random() - 0.5) });
            };
            useEffect(() => { generate(); }, []);
            const handleAnswer = (cat) => {
                if (cat === q.item.c) { onCorrect(20); if (count + 1 >= 5) setTimeout(onComplete, 1000); else { setCount(c => c + 1); generate(); } } else onWrong();
            };
            if(!q) return null;
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>ë‹¤ìŒ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</p>
                    <div className="bg-rose-50 px-8 py-10 rounded-2xl mb-8 w-full text-center border-2 border-rose-100"><p className={styles.bigText}>{q.item.t}</p></div>
                    <div className="grid grid-cols-2 gap-3 w-full">
                        {q.opts.map((opt, i) => (<button key={i} onClick={() => handleAnswer(opt)} className={`${styles.button} bg-white border-rose-200 text-rose-900 hover:bg-rose-50`}>{opt}</button>))}
                    </div>
                </div>
            );
        }

        // --- 10. ë°©í–¥ ì°¾ê¸° (Direction) ---
        const DirectionGame = ({ onComplete, onCorrect, onWrong }) => {
            const [q, setQ] = useState(null); const [count, setCount] = useState(0);
            const dirs = ['ì™¼ìª½', 'ì˜¤ë¥¸ìª½', 'ìœ„', 'ì•„ë˜'];
            const arrows = {'ì™¼ìª½':'â†', 'ì˜¤ë¥¸ìª½':'â†’', 'ìœ„':'â†‘', 'ì•„ë˜':'â†“'};
            
            const generate = () => {
                const target = dirs[Math.floor(Math.random()*4)];
                setQ(target);
            };
            useEffect(() => { generate(); }, []);
            
            const handleAnswer = (val) => {
                if (val === q) { onCorrect(20); if (count + 1 >= 5) setTimeout(onComplete, 1000); else { setCount(c => c + 1); generate(); } } else onWrong();
            };
            
            if(!q) return null;
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>í™”ì‚´í‘œì˜ <span className="text-cyan-600">ë°©í–¥</span>ì„ ê³ ë¥´ì„¸ìš”.</p>
                    <div className="bg-cyan-50 px-8 py-8 rounded-2xl mb-8 w-full text-center border-2 border-cyan-100"><p className="text-8xl font-black text-cyan-900">{arrows[q]}</p></div>
                    <div className="grid grid-cols-2 gap-3 w-full">
                        {dirs.map((d, i) => (<button key={i} onClick={() => handleAnswer(d)} className={`${styles.button} bg-white border-cyan-200 text-cyan-900`}>{d}</button>))}
                    </div>
                </div>
            );
        }

        // --- 5. ìˆœì„œ ê¸°ì–µ (Memory) ---
        const MemoryGame = ({ onComplete, onCorrect, onWrong, playSound }) => {
            const [sequence, setSequence] = useState([]); const [playerSequence, setPlayerSequence] = useState([]);
            const [isPlaying, setIsPlaying] = useState(false); const [activeIndex, setActiveIndex] = useState(null); const [round, setRound] = useState(0);
            const items = [0, 1, 2, 3]; const bgColors = ['bg-pink-400', 'bg-yellow-400', 'bg-sky-400', 'bg-emerald-400'];
            const startRound = (level) => {
                setPlayerSequence([]); setIsPlaying(true);
                const newSeq = []; for(let i=0; i < level + 3; i++) newSeq.push(Math.floor(Math.random() * 4)); setSequence(newSeq);
                let i = 0;
                const interval = setInterval(() => {
                    if (i >= newSeq.length) { clearInterval(interval); setActiveIndex(null); setIsPlaying(false); return; }
                    setActiveIndex(newSeq[i]); playSound('click'); setTimeout(() => setActiveIndex(null), 600); i++;
                }, 1000);
            };
            useEffect(() => { startRound(round); }, [round]);
            const handleTap = (idx) => {
                if (isPlaying) return;
                setActiveIndex(idx); playSound('click'); setTimeout(() => setActiveIndex(null), 200);
                const nextIdx = playerSequence.length;
                if (sequence[nextIdx] === idx) {
                    const newPlayerSeq = [...playerSequence, idx]; setPlayerSequence(newPlayerSeq);
                    if (newPlayerSeq.length === sequence.length) { onCorrect(30); if (round + 1 >= 3) { setTimeout(onComplete, 1000); } else { setTimeout(() => setRound(r => r + 1), 1000); } }
                } else {
                    onWrong(); setPlayerSequence([]); setTimeout(() => { let i = 0; setIsPlaying(true); const interval = setInterval(() => { if (i >= sequence.length) { clearInterval(interval); setActiveIndex(null); setIsPlaying(false); return; } setActiveIndex(sequence[i]); playSound('click'); setTimeout(() => setActiveIndex(null), 600); i++; }, 1000); }, 1000);
                }
            };
            return (
                <div className="w-full flex flex-col items-center animate-fade-in">
                    <p className={styles.instruction}>ë¶ˆì´ ë“¤ì–´ì˜¨ <span className="text-pink-600">ìˆœì„œëŒ€ë¡œ</span> ëˆ„ë¥´ì„¸ìš”.</p>
                    <div className="grid grid-cols-2 gap-4 mb-6">{items.map((item) => (<button key={item} onClick={() => handleTap(item)} disabled={isPlaying} className={`w-32 h-32 rounded-2xl border-b-8 transition-all active:border-b-0 active:translate-y-2 ${activeIndex === item ? 'scale-105 brightness-110 border-gray-600' : 'border-black/10'} ${bgColors[item]} flex items-center justify-center`}><Star fill="white" size={48} className="text-white/80" /></button>))}</div>
                    <div className="h-8">{isPlaying ? <span className="text-amber-600 font-bold animate-pulse text-2xl">ì˜ ë³´ì„¸ìš”...</span> : <span className="text-green-600 font-bold text-2xl">ì‹œì‘í•˜ì„¸ìš”!</span>}</div>
                </div>
            );
        };

        // --- ê²°ê³¼ í™”ë©´ ---
        const ResultScreen = ({ score, userName, onRestart, playSound, mode }) => {
            useEffect(() => { playSound('fanfare'); }, []);
            return (
                <div className="flex flex-col items-center animate-zoom-in w-full">
                    <Trophy size={80} className="text-yellow-500 mb-4 drop-shadow-md" />
                    <h2 className="text-3xl font-bold text-gray-800 mb-2">ìš´ë™ ì™„ë£Œ!</h2>
                    <p className="text-gray-600 mb-6 text-xl text-center">ì˜¤ëŠ˜ë„ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤,<br/><span className="text-green-600 font-bold">{userName} ë‹˜!</span></p>
                    <div className="bg-yellow-50 border-2 border-yellow-200 p-6 rounded-2xl w-full text-center mb-8"><p className="text-gray-500 mb-2">íšë“ ì ìˆ˜</p><p className="text-6xl font-black text-amber-600">{score}ì </p></div>
                    <button onClick={onRestart} className={`${styles.button} bg-green-500 text-white border-green-700`}><RotateCcw size={28} />{mode === 'single' ? 'ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°' : 'ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°'}</button>
                </div>
            );
        };

        // --- ë©”ì¸ App ì»´í¬ë„ŒíŠ¸ ---
        const App = () => {
            const [gameState, setGameState] = useState('nameInput'); 
            const [gameQueue, setGameQueue] = useState([]); 
            const [currentQueueIdx, setCurrentQueueIdx] = useState(0);
            const [gameMode, setGameMode] = useState('course'); 
            const [userName, setUserName] = useState('');
            const [score, setScore] = useState(0);
            const [feedback, setFeedback] = useState(null); // { type: 'correct'|'wrong', msg: string }
            const [soundEnabled, setSoundEnabled] = useState(true);
            const [hasDoneOrientation, setHasDoneOrientation] = useState(false);

            const playSound = useCallback((type) => {
                if (!soundEnabled) return;
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext; if (!AudioContext) return; const ctx = new AudioContext(); const osc = ctx.createOscillator(); const gain = ctx.createGain(); osc.connect(gain); gain.connect(ctx.destination); const now = ctx.currentTime;
                    if (type === 'correct') { osc.type = 'sine'; osc.frequency.setValueAtTime(523.25, now); osc.frequency.setValueAtTime(659.25, now + 0.1); osc.frequency.setValueAtTime(783.99, now + 0.2); gain.gain.setValueAtTime(0.2, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.6); osc.start(now); osc.stop(now + 0.6); }
                    else if (type === 'wrong') { osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.3); gain.gain.setValueAtTime(0.2, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3); osc.start(now); osc.stop(now + 0.3); }
                    else if (type === 'click') { osc.type = 'triangle'; osc.frequency.setValueAtTime(800, now); gain.gain.setValueAtTime(0.05, now); gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05); osc.start(now); osc.stop(now + 0.05); }
                    else if (type === 'fanfare') { osc.type = 'square'; osc.frequency.setValueAtTime(523.25, now); osc.frequency.setValueAtTime(523.25, now + 0.1); osc.frequency.setValueAtTime(523.25, now + 0.2); osc.frequency.setValueAtTime(659.25, now + 0.3); osc.frequency.setValueAtTime(783.99, now + 0.4); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 1.5); osc.start(now); osc.stop(now + 1.5); }
                } catch (e) { console.error(e); }
            }, [soundEnabled]);

            const showFeedback = (isCorrect) => {
                playSound(isCorrect ? 'correct' : 'wrong');
                const randomPraise = praises[Math.floor(Math.random() * praises.length)];
                setFeedback({ type: isCorrect ? 'correct' : 'wrong', msg: isCorrect ? randomPraise : "ê´œì°®ì•„ìš”, ë‹¤ì‹œ í•´ë³´ì„¸ìš”!" });
                setTimeout(() => setFeedback(null), 1000);
            };

            const handleCorrect = (points) => { showFeedback(true); setScore(s => s + points); };
            const handleWrong = () => { showFeedback(false); };

            const startDailyCourse = () => {
                const allGames = ['math', 'word', 'spatial', 'stroop', 'memory', 'number', 'rps', 'reaction', 'category', 'direction'];
                const randomGames = allGames.sort(() => Math.random() - 0.5).slice(0, 5);
                setGameQueue([...randomGames, 'result']);
                setCurrentQueueIdx(0); setScore(0); setGameMode('course'); setGameState(randomGames[0]); playSound('click');
            };

            const startSingleGame = (gameType) => {
                setGameQueue([gameType, 'result']); setCurrentQueueIdx(0); setScore(0); setGameMode('single'); setGameState(gameType); playSound('click');
            };

            const handleStageComplete = () => {
                const nextIdx = currentQueueIdx + 1;
                if (nextIdx < gameQueue.length) { setCurrentQueueIdx(nextIdx); setGameState(gameQueue[nextIdx]); }
            };
            
            const goBackToMenu = () => { if (confirm('ë©”ë‰´ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) { setGameState('menu'); setScore(0); } };

            return (
                <div className={styles.container}>
                    {gameState !== 'nameInput' && (
                        <div className="w-full max-w-md px-1 pt-4 pb-2 flex items-center justify-between animate-fade-in">
                            <span className="text-xl font-bold text-amber-800 flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-sm border border-amber-100"><Heart size={24} className="text-red-500" fill="red" /> {score}ì </span>
                            <div className="flex items-center gap-2">
                                {gameState !== 'menu' && gameState !== 'result' && gameState !== 'orientation' && gameState !== 'record' && (<button onClick={goBackToMenu} className="text-gray-400 p-2 bg-white rounded-full shadow-sm border border-gray-100" title="ë©”ë‰´ë¡œ"><Home size={20} /></button>)}
                                <span className="text-sm font-bold text-gray-500 bg-gray-100 px-3 py-1 rounded-full">{userName}ë‹˜</span>
                                <button onClick={() => setSoundEnabled(!soundEnabled)} className="text-gray-400 p-2 bg-white rounded-full shadow-sm border border-gray-100">{soundEnabled ? <Volume2 size={20} /> : <div className="relative"><Volume2 size={20} className="opacity-50"/><XIcon size={14} className="absolute -top-1 -right-1"/></div>}</button>
                            </div>
                        </div>
                    )}

                    <div className={`${styles.card} mt-2 min-h-[550px] justify-start relative pb-12`}>
                        {gameState === 'nameInput' && <NameInputScreen onNameSubmit={(name) => { setUserName(name); setGameState('orientation'); }} playSound={playSound} />}
                        {gameState === 'menu' && <GameMenu userName={userName} onStartCourse={startDailyCourse} onSelectGame={startSingleGame} onOpenRecord={() => {setGameState('record'); playSound('click');}} />}
                        {gameState === 'record' && <DailyRecord onBack={() => {setGameState('menu'); playSound('click');}} playSound={playSound} />}
                        {gameState === 'orientation' && <OrientationGame onComplete={() => { setHasDoneOrientation(true); setGameState('menu'); }} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        
                        {gameState === 'math' && <MathGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        {gameState === 'word' && <WordGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        {gameState === 'spatial' && <SpatialGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        {gameState === 'stroop' && <StroopGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        {gameState === 'memory' && <MemoryGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} playSound={playSound} />}
                        {gameState === 'number' && <NumberGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        {gameState === 'rps' && <RPSGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        {gameState === 'reaction' && <ReactionGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        {gameState === 'category' && <CategoryGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        {gameState === 'direction' && <DirectionGame onComplete={handleStageComplete} onCorrect={handleCorrect} onWrong={handleWrong} />}
                        
                        {gameState === 'result' && <ResultScreen score={score} userName={userName} mode={gameMode} onRestart={() => { setGameState('menu'); setScore(0); }} playSound={playSound} />}

                        {feedback && (
                            <div className={styles.feedbackOverlay}>
                                {feedback.type === 'correct' ? 
                                    <div className="bg-white p-8 rounded-3xl shadow-2xl animate-bounce-short flex flex-col items-center"><div className="w-24 h-24 rounded-full bg-green-100 flex items-center justify-center mb-2"><Check size={48} className="text-green-600" strokeWidth={4}/></div><p className="text-green-600 font-black text-3xl mb-2">ì •ë‹µ!</p><p className="text-gray-600 font-bold text-xl">{feedback.msg}</p></div> 
                                    : <div className="bg-white p-8 rounded-3xl shadow-2xl animate-bounce-short flex flex-col items-center"><div className="w-24 h-24 rounded-full bg-red-100 flex items-center justify-center mb-2"><XIcon size={48} className="text-red-500" strokeWidth={4}/></div><p className="text-red-500 font-black text-3xl mb-2">ë•¡!</p><p className="text-gray-600 font-bold text-xl">{feedback.msg}</p></div>}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
